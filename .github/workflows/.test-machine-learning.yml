---
name: . Test Machine Learning

'on':
  workflow_call:
    inputs:
      # Workflows
      workflow:
        required: true
        type: boolean
      # Applications
      amazon-sagemaker-triton-resnet-50-deploy:
        required: true
        type: boolean
      amazon-sagemaker-triton-resnet-50-infer:
        required: true
        type: boolean
      convolutional-neural-network:
        required: true
        type: boolean
      feature-store:
        required: true
        type: boolean
      fine-tune-whisper:
        required: true
        type: boolean
      graph-neural-network:
        required: true
        type: boolean
      hm-autogluon:
        required: true
        type: boolean
      hm-axolotl:
        required: true
        type: boolean
      hm-cuml:
        required: true
        type: boolean
      hm-deepeval:
        required: true
        type: boolean
      hm-docling:
        required: true
        type: boolean
      hm-faster-whisper:
        required: true
        type: boolean
      hm-flax:
        required: true
        type: boolean
      hm-gradio-classify-image:
        required: true
        type: boolean
      hm-imagebind:
        required: true
        type: boolean
      hm-kubeflow-calculate:
        required: true
        type: boolean
      hm-kubeflow-classify-mnist:
        required: true
        type: boolean
      hm-langchain-chat-pdf:
        required: true
        type: boolean
      hm-langgraph-chat-pdf:
        required: true
        type: boolean
      hm-llama-factory:
        required: true
        type: boolean
      hm-llama-index-chat-pdf:
        required: true
        type: boolean
      hm-mineru:
        required: true
        type: boolean
      hm-mlflow-classify-mnist:
        required: true
        type: boolean
      hm-mlflow-predict-diabetes:
        required: true
        type: boolean
      hm-mlx-lm:
        required: true
        type: boolean
      hm-nvidia-modulus:
        required: true
        type: boolean
      hm-olmocr:
        required: true
        type: boolean
      hm-pydantic-ai-chat-pdf:
        required: true
        type: boolean
      hm-rasa:
        required: true
        type: boolean
      hm-scikit-learn:
        required: true
        type: boolean
      hm-sglang:
        required: true
        type: boolean
      hm-streamlit-live-line-chart:
        required: true
        type: boolean
      hm-streamlit-map:
        required: true
        type: boolean
      hm-torchtune:
        required: true
        type: boolean
      hm-unsloth:
        required: true
        type: boolean
      hugging-face-analyze-sentiment:
        required: true
        type: boolean
      hyperparameter-optimization:
        required: true
        type: boolean
      model-context-protocol:
        required: true
        type: boolean
      neural-forecasting-forecast-air-passenger-number:
        required: true
        type: boolean
      nvidia-dali:
        required: true
        type: boolean
      open-clip:
        required: true
        type: boolean
      quantization:
        required: true
        type: boolean
      reinforcement-learning-cart-pole:
        required: true
        type: boolean
      stable-diffusion:
        required: true
        type: boolean
      transformer:
        required: true
        type: boolean

jobs:
  deepeval-test:
    name: DeepEval | Test
    if: ${{ inputs.workflow || inputs.hm-deepeval }}
    runs-on: ubuntu-24.04
    environment: test
    timeout-minutes: 10
    steps:
      - name: Checkout
        uses: actions/checkout@v4.2.2
      - name: Install NVIDIA CUDA Toolkit
        uses: Jimver/cuda-toolkit@v0.2.24
        id: cuda-toolkit
        with:
          cuda: 12.9.0
          method: network
      - name: Install uv
        uses: astral-sh/setup-uv@v6.3.1
        with:
          version: 0.7.13
          enable-cache: true
          cache-dependency-glob: llm-evaluation/hm-deepeval/uv.lock
      - name: Set up Python
        uses: actions/setup-python@v5.6.0
        with:
          python-version-file: llm-evaluation/hm-deepeval/pyproject.toml
      - name: Install dependencies
        working-directory: llm-evaluation/hm-deepeval
        run: |
          uv sync --dev
      - name: Test
        working-directory: llm-evaluation/hm-deepeval
        run: |
          uv run poe test-coverage
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v5.4.3
        with:
          directory: llm-evaluation/hm-deepeval
