# https://github.com/grafana/mimir/blob/main/operations/helm/charts/mimir-distributed/values.yaml
# https://grafana.com/docs/mimir/latest/configure/configure-object-storage-backend/
---
image:
  repository: harbor.hongbomiao.com/docker-hub-proxy-cache/grafana/mimir
mimir:
  structuredConfig:
    common:
      storage:
        backend: s3
        s3:
          endpoint: s3.us-west-2.amazonaws.com
          region: us-west-2
    alertmanager_storage:
      s3:
        bucket_name: production-hm-mimir-alertmanager
    blocks_storage:
      s3:
        bucket_name: production-hm-mimir-block
    ruler_storage:
      s3:
        bucket_name: production-hm-mimir-ruler
    limits:
      max_global_series_per_user: 10000000000
      ingestion_burst_size: 100000000
      ingestion_rate: 1000000
    usage_stats:
      enabled: false
# https://grafana.com/docs/mimir/latest/configure/about-runtime-configuration/
runtimeConfig:
  distributor_limits:
    # 300 MiB
    max_inflight_push_requests_bytes: 314572800
    max_inflight_push_requests: 30000
    max_ingestion_rate: 5000000
  ingester_limits:
    max_inflight_push_requests: 30000
    max_ingestion_rate: 5000000
    max_series: 100000000
    max_tenants: 1000
serviceAccount:
  create: true
  name: hm-mimir
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::272394222652:role/MimirRole-hm-mimir
alertmanager:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: alertmanager
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 10Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 20m
      memory: 100Mi
    limits:
      memory: 100Mi
compactor:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: compactor
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 100Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 20m
      memory: 3600Mi
    limits:
      memory: 3600Mi
distributor:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: distributor
  resources:
    requests:
      cpu: 500m
      memory: 800Mi
    limits:
      memory: 800Mi
kafka:
  enabled: true
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  persistence:
    size: 1Ti
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 200m
      memory: 4200Mi
    limits:
      memory: 4200Mi
ingester:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: ingester
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 100Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 600m
      memory: 10Gi
    limits:
      memory: 10Gi
overrides_exporter:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: overrides-exporter
      effect: NoSchedule
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
querier:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: querier
  resources:
    requests:
      cpu: 30m
      memory: 200Mi
    limits:
      memory: 200Mi
query_frontend:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: query-frontend
  resources:
    requests:
      cpu: 20m
      memory: 200Mi
    limits:
      memory: 200Mi
query_scheduler:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: query-scheduler
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
rollout_operator:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
ruler:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: ruler
  resources:
    requests:
      cpu: 20m
      memory: 100Mi
    limits:
      memory: 100Mi
store_gateway:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: store-gateway
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 100Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 20m
      memory: 200Mi
    limits:
      memory: 200Mi
gateway:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: gateway
  resources:
    requests:
      cpu: 30m
      memory: 100Mi
    limits:
      memory: 100Mi
minio:
  enabled: false
nginx:
  enabled: false
