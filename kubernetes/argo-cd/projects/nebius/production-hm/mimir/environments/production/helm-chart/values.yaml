# https://github.com/grafana/mimir/blob/main/operations/helm/charts/mimir-distributed/values.yaml
# https://grafana.com/docs/mimir/latest/configure/configure-object-storage-backend/
---
image:
  repository: harbor.hongbomiao.com/docker-hub-proxy-cache/grafana/mimir
mimir:
  structuredConfig:
    common:
      storage:
        backend: s3
        s3:
          endpoint: storage.us-central1.nebius.cloud
          region: us-central1
    alertmanager_storage:
      s3:
        bucket_name: production-hm-mimir-alertmanager
    blocks_storage:
      s3:
        bucket_name: production-hm-mimir-block
    ruler_storage:
      s3:
        bucket_name: production-hm-mimir-ruler
    limits:
      max_global_series_per_user: 10000000000
      ingestion_burst_size: 100000000
      ingestion_rate: 1000000
    usage_stats:
      enabled: false
# https://grafana.com/docs/mimir/latest/configure/about-runtime-configuration/
runtimeConfig:
  distributor_limits:
    # 300 MiB
    max_inflight_push_requests_bytes: 314572800
    max_inflight_push_requests: 30000
    max_ingestion_rate: 5000000
  ingester_limits:
    max_inflight_push_requests: 30000
    max_ingestion_rate: 5000000
    max_series: 100000000
    max_tenants: 1000
kedaAutoscaling:
  prometheusAddress: http://prometheus-kube-prometheus-prometheus.production-hm-prometheus.svc:9090
serviceAccount:
  create: true
alertmanager:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: alertmanager
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 10Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 20m
      memory: 100Mi
    limits:
      memory: 100Mi
compactor:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: compactor
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 100Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 20m
      memory: 3600Mi
    limits:
      memory: 3600Mi
distributor:
  enabled: true
  kedaAutoscaling:
    enabled: true
    minReplicaCount: 3
    maxReplicaCount: 15
    targetCPUUtilizationPercentage: 100
    targetMemoryUtilizationPercentage: 100
    behavior:
      scaleDown:
        policies:
          - periodSeconds: 600
            type: Percent
            value: 10
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: distributor
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      memory: 1Gi
kafka:
  enabled: true
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  persistence:
    size: 1Ti
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 200m
      memory: 4200Mi
    limits:
      memory: 4200Mi
ingester:
  enabled: true
  replicas: 9
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: ingester
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 100Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 600m
      memory: 3Gi
    limits:
      memory: 20Gi
overrides_exporter:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: overrides-exporter
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
querier:
  enabled: true
  kedaAutoscaling:
    enabled: true
    minReplicaCount: 3
    maxReplicaCount: 10
    querySchedulerInflightRequestsThreshold: 12
    behavior:
      scaleDown:
        policies:
          - periodSeconds: 120
            type: Percent
            value: 10
        stabilizationWindowSeconds: 600
      scaleUp:
        policies:
          - periodSeconds: 120
            type: Percent
            value: 50
          - periodSeconds: 120
            type: Pods
            value: 15
        stabilizationWindowSeconds: 60
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: querier
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 30m
      memory: 200Mi
    limits:
      memory: 200Mi
query_frontend:
  enabled: true
  kedaAutoscaling:
    enabled: true
    minReplicaCount: 3
    maxReplicaCount: 10
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 100
    behavior:
      scaleDown:
        policies:
          - periodSeconds: 60
            type: Percent
            value: 10
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: query-frontend
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 20m
      memory: 200Mi
    limits:
      memory: 200Mi
query_scheduler:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: query-scheduler
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
rollout_operator:
  enabled: true
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 100Mi
ruler:
  enabled: true
  kedaAutoscaling:
    enabled: true
    minReplicaCount: 3
    maxReplicaCount: 10
    targetCPUUtilizationPercentage: 100
    targetMemoryUtilizationPercentage: 100
    behavior:
      scaleDown:
        policies:
          - periodSeconds: 600
            type: Percent
            value: 10
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: ruler
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 20m
      memory: 100Mi
    limits:
      memory: 100Mi
ruler_querier:
  enabled: true
  kedaAutoscaling:
    enabled: true
    minReplicaCount: 1
    maxReplicaCount: 10
    querySchedulerInflightRequestsThreshold: 12
    behavior:
      scaleDown:
        policies:
          - periodSeconds: 120
            type: Percent
            value: 10
        stabilizationWindowSeconds: 600
      scaleUp:
        policies:
          - periodSeconds: 120
            type: Percent
            value: 50
          - periodSeconds: 120
            type: Pods
            value: 15
        stabilizationWindowSeconds: 60
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 30m
      memory: 200Mi
    limits:
      memory: 200Mi
ruler_query_frontend:
  enabled: true
  kedaAutoscaling:
    enabled: true
    minReplicaCount: 1
    maxReplicaCount: 10
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 100
    behavior:
      scaleDown:
        policies:
          - periodSeconds: 60
            type: Percent
            value: 10
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 20m
      memory: 200Mi
    limits:
      memory: 200Mi
store_gateway:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: store-gateway
  extraEnvFrom:
    - secretRef:
        name: hm-mimir-secret
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  persistentVolume:
    accessModes: ["ReadWriteOnce"]
    size: 100Gi
    storageClass: production-hm-mimir-storage-class
  resources:
    requests:
      cpu: 20m
      memory: 200Mi
    limits:
      memory: 1Gi
gateway:
  enabled: true
  replicas: 3
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/component: gateway
  nodeSelector:
    environment: production
  tolerations:
    - key: environment
      operator: Equal
      value: production
      effect: NoSchedule
  resources:
    requests:
      cpu: 30m
      memory: 100Mi
    limits:
      memory: 100Mi
  nginx:
    config:
      resolver: coredns.kube-system.svc.cluster.local.
minio:
  enabled: false
nginx:
  enabled: false
