# https://github.com/grafana/helm-charts/blob/main/charts/grafana/values.yaml
---
global:
  imageRegistry: harbor.hongbomiao.com/docker-hub-proxy-cache
replicas: 3
admin:
  existingSecret: hm-grafana-secret
  userKey: GRAFANA_ADMIN_USER_NAME
  passwordKey: GRAFANA_ADMIN_PASSWORD
envValueFrom:
  POSTGRES_USER_NAME:
    secretKeyRef:
      name: hm-grafana-secret
      key: POSTGRES_USER_NAME
  POSTGRES_PASSWORD:
    secretKeyRef:
      name: hm-grafana-secret
      key: POSTGRES_PASSWORD
  GOOGLE_CLIENT_SECRET:
    secretKeyRef:
      name: hm-grafana-secret
      key: GOOGLE_CLIENT_SECRET
# https://github.com/grafana/grafana/blob/main/conf/defaults.ini
grafana.ini:
  server:
    root_url: https://grafana.hongbomiao.com
  auth:
    disable_login_form: true
  auth.basic:
    enabled: false
  auth.google:
    enabled: true
    allow_sign_up: true
    auto_login: false
    client_id: xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com
    client_secret: $__env{GOOGLE_CLIENT_SECRET}
    scopes: openid email profile
    auth_url: https://accounts.google.com/o/oauth2/v2/auth
    token_url: https://oauth2.googleapis.com/token
    api_url: https://openidconnect.googleapis.com/v1/userinfo
    allowed_domains: hongbomiao.com
    use_pkce: true
    use_refresh_token: true
  database:
    type: postgres
    host: private-rw.postgresql-xxxxxxxxxxxxxxxxxx.backbone-xxxxxxxxxxxxxxxxxx.msp.us-central1.nebius.cloud:5432
    name: grafana_db
    user: $__env{POSTGRES_USER_NAME}
    password: $__env{POSTGRES_PASSWORD}
    ssl_mode: require
plugins:
  - nline-plotlyjs-panel
  - redis-datasource
  - trino-datasource
persistence:
  enabled: false
  type: pvc
sidecar:
  dashboards:
    enabled: true
    searchNamespace: ALL
  resources:
    requests:
      cpu: 50m
      memory: 256Mi
    limits:
      cpu: 100m
      memory: 512Mi
datasources:
  datasources.yaml:
    apiVersion: 1
    # deleteDatasources:
    #   - name: xxx
    datasources:
      - name: hm-prometheus
        type: prometheus
        isDefault: true
        url: http://prometheus-kube-prometheus-prometheus.production-hm-prometheus.svc:9090
        access: proxy
      - name: hm-loki
        type: loki
        isDefault: false
        url: http://loki-gateway.production-hm-loki.svc:80
        access: proxy
        jsonData:
          httpHeaderName1: X-Scope-OrgID
        secureJsonData:
          httpHeaderValue1: hm
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: hm-kubernetes-dashboards
        orgId: 1
        folder: Kubernetes
        type: file
        disableDeletion: true
        editable: false
        options:
          path: /var/lib/grafana/dashboards/hm-kubernetes-dashboards
dashboards:
  hm-kubernetes-dashboards:
    hm-kubernetes-system-api-server-dashboard:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/master/dashboards/k8s-system-api-server.json
    hm-kubernetes-system-coredns-dashboard:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/master/dashboards/k8s-system-coredns.json
    hm-kubernetes-views-global-dashboard:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/master/dashboards/k8s-views-global.json
    hm-kubernetes-views-namespaces-dashboard:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/master/dashboards/k8s-views-namespaces.json
    hm-kubernetes-views-nodes-dashboard:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/master/dashboards/k8s-views-nodes.json
    hm-kubernetes-views-pods-dashboard:
      url: https://raw.githubusercontent.com/dotdc/grafana-dashboards-kubernetes/master/dashboards/k8s-views-pods.json
resources:
  requests:
    cpu: 200m
    memory: 1Gi
  limits:
    cpu: 500m
    memory: 2Gi
