# https://github.com/grafana-community/helm-charts/blob/main/charts/grafana/values.yaml
---
global:
  imageRegistry: harbor.hongbomiao.com/docker-hub-proxy-cache
replicas: 3
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
admin:
  existingSecret: hm-grafana-secret
  userKey: GRAFANA_ADMIN_USER_NAME
  passwordKey: GRAFANA_ADMIN_PASSWORD
envValueFrom:
  POSTGRES_USER_NAME:
    secretKeyRef:
      name: hm-grafana-secret
      key: POSTGRES_USER_NAME
  POSTGRES_PASSWORD:
    secretKeyRef:
      name: hm-grafana-secret
      key: POSTGRES_PASSWORD
  GOOGLE_CLIENT_SECRET:
    secretKeyRef:
      name: hm-grafana-secret
      key: GOOGLE_CLIENT_SECRET
# https://github.com/grafana/grafana/blob/main/conf/defaults.ini
grafana.ini:
  server:
    root_url: https://grafana.hongbomiao.com
  auth:
    disable_login_form: true
  auth.basic:
    enabled: true
  auth.google:
    enabled: true
    allow_sign_up: true
    auto_login: false
    client_id: xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com
    client_secret: $__env{GOOGLE_CLIENT_SECRET}
    scopes: openid email profile
    auth_url: https://accounts.google.com/o/oauth2/v2/auth
    token_url: https://oauth2.googleapis.com/token
    api_url: https://openidconnect.googleapis.com/v1/userinfo
    allowed_domains: hongbomiao.com
    use_pkce: true
    use_refresh_token: true
  database:
    type: postgres
    host: private-rw.postgresql-xxxxxxxxxxxxxxxxxx.backbone-xxxxxxxxxxxxxxxxxx.msp.us-central1.nebius.cloud:5432
    name: grafana_db
    user: $__env{POSTGRES_USER_NAME}
    password: $__env{POSTGRES_PASSWORD}
    ssl_mode: require
plugins:
  - nline-plotlyjs-panel
  - redis-datasource
  - trino-datasource
persistence:
  enabled: false
  type: pvc
sidecar:
  dashboards:
    enabled: true
    searchNamespace: ALL
    folderAnnotation: grafana_folder
    provider:
      foldersFromFilesStructure: true
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      memory: 200Mi
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: kubernetes.io/hostname
    whenUnsatisfiable: DoNotSchedule
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: grafana
nodeSelector:
  environment: production
tolerations:
  - key: environment
    operator: Equal
    value: production
    effect: NoSchedule
resources:
  requests:
    cpu: 100m
    memory: 400Mi
  limits:
    memory: 800Mi
